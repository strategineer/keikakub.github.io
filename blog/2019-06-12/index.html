<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta content="Strat's Blog - I code review an 8 year old project" property="og:title"><meta content="One of the first projects I worked on after learning how to program, around 8 years ago, is called writerator. It is a Python command line interface (or CLI for short) for analyzing English language text and generating randomized poetry such as haikus and poems. I was contemplating using it to build a new side project which would analyze text from all over the internet from the previous day (news articles, Twitter posts, etc...." property="og:description"><meta content="https://strategineer.com/blog/2019-06-12/" property="og:url"><meta content="/blog/2019-06-12/thumbnail_hu9cac37927a1534c1b267387f950ff1cb_1724976_0x300_resize_q90_h2_box_3.webp" property="og:image"><meta name=twitter:card content="summary_large_image"><meta content="#43B581" data-react-helmet=true name=theme-color><link rel=apple-touch-icon sizes=180x180 href="/apple-touch-icon.png?v=1"><link rel=icon type=image/png sizes=32x32 href="/favicon-32x32.png?v=1"><link rel=icon type=image/png sizes=16x16 href="/favicon-16x16.png?v=1"><link rel=manifest href="/site.webmanifest?v=1"><link rel=mask-icon href="/safari-pinned-tab.svg?v=1" color=#5bbad5><link rel="shortcut icon" href="/favicon.ico?v=1"><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ff0000"><meta name=description content="Author: strategineer, category: blog, description: "><link href="/css/site.min.57676d9d5d25e504a61a4898f0549ec510620eb8e5857c1c26619d918527cd75.css" rel=stylesheet><title>Strat's Blog</title></head><body id=documentTop><link href=/pagefind/pagefind-ui.css rel=stylesheet><script src=/pagefind/pagefind-ui.js></script><script>window.addEventListener("DOMContentLoaded",e=>{new PagefindUI({element:"#search",showSubResults:!0})})</script><div class=container-fluid><div class="row no-margin justify-content-center"><div class="col-xl-12 main no-margin"><nav class=footer-index><div class="d-flex justify-content-center"><div class="col-xl-9 col-12"><div class="container author-blurb"><div class="row justify-content-center"><div class=col-auto><a href=https://strategineer.com/><img alt="Strat's Avatar" class="rounded avatar-static float-left" src=/img/fe_portrait.png></a></div><div class="col-md-6 col-auto align-self-center"><div class=row><div class="col-auto text-center">Name's Strat; I'm a rooster illusion and I write about whatever I feel like writing about.
<a href=https://fraidyc.at>Follow me with fraidycat</a>, or an <a href=https://en.wikipedia.org/wiki/RSS>RSS reader</a>, to be notified whenever I write something.</div></div></div></div></div></div></div></nav><div class=readable><div id=search></div></div><div class=readable><div class=blog-content data-pagefind-body><div class="container justify-content-center text-center page-title"><div class=row><h1>I code review an 8 year old project</h1></div></div><div class="row justify-content-center"><div class="col-auto align-self-center text-center">10min read</div></div><div class="row justify-content-center"><div class="col-auto align-self-center"><div class="d-flex justify-content-center readable"><div class=col-12><div class=row><div class=col-mx-auto><img loading=lazy alt=thumbnail class="img-fluid rounded mx-auto d-block" width=300 height=300 src=/blog/2019-06-12/thumbnail_hu9cac37927a1534c1b267387f950ff1cb_1724976_0x300_resize_q90_h2_box_3.webp></div></div></div></div></div></div><div class="row justify-content-center"><div class="col-auto align-self-center"><div class="d-flex justify-content-center d-flex-inline-list"><div class=text-center><ul class="list-inline ul-inline"><li class="list-inline-item li-inline"><a href=https://strategineer.com/blog/tags/tech/>Tech</a></li></ul></div></div></div></div><div class="row justify-content-center readable"><p>One of the first projects I worked on after learning how to program, around 8 years ago, is called <a href=https://github.com/KeikakuB/writerator/tree/legacy>writerator</a>. It is a Python command line interface (or CLI for short) for analyzing English language text and generating randomized poetry such as haikus and poems. I was contemplating using it to build a new side project which would analyze text from all over the internet from the previous day (news articles, Twitter posts, etc.), then generate a new short poem every day using the words from the analyzed text and post it to Twitter.</p><p>After taking a look at the code, I quickly realized that if I was to write the same code today I would not write it at all like it is now.</p><p>I thought it would be an interesting exercise to perform a code review on the project from the perspective of a programmer with many more years of experience under my belt, use the code review as a jumping off point to overhaul the code and be able to use it as the foundation of my &ldquo;daily poem&rdquo; project.</p><p>The writerator project is pretty small in scope. The repo contains ~600 lines of code and ~150 lines of comments (about 30% of which are old Apache license contained within each <em>.py</em> file, even though I changed the license to the MIT license years ago). Ignoring the <em>writeratorgui.py</em> file which contains placeholder/example code for the tkinter GUI framework, the writerator project has three different <em>.py</em> files which do work.</p><p>Let&rsquo;s take a brief look at each of these files in turn; taking note of the notable problems as we go along.</p><h2 id=_writeratorpy_><em>writerator.py</em>
<a href=#_writeratorpy_>¶</a></h2><p>This file has 246 lines of code, 35 comment lines and 111 blank lines. It contains the CLI code and does most of the work.</p><dl><dt>Problem:</dt><dd>Messy CLI argument parsing code. argparse is a python module that comes built-in with python for helping to create CLI scripts but the code tied to it becomes very messy when used for more complicated CLIs. There are almost 100 lines dedicated to a <em>def make_parser(config):</em> function which sets up all the required parsers for the different sub-commands that the writerator CLI supports (poem generation but also text analysis tools for counting most commons characters, words, etc. and computing the Gunning-Fog index).</dd></dl><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>make_parser</span>(config):
</span></span><span style=display:flex><span>    main_parser <span style=color:#f92672>=</span> argparse<span style=color:#f92672>.</span>ArgumentParser()
</span></span><span style=display:flex><span>    main_parser<span style=color:#f92672>.</span>add_argument(<span style=color:#e6db74>&#39;infile&#39;</span>, nargs<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;?&#39;</span>, type<span style=color:#f92672>=</span>argparse<span style=color:#f92672>.</span>FileType(<span style=color:#e6db74>&#39;r&#39;</span>),
</span></span><span style=display:flex><span>                        default<span style=color:#f92672>=</span>sys<span style=color:#f92672>.</span>stdin)
</span></span><span style=display:flex><span>    main_parser<span style=color:#f92672>.</span>add_argument(<span style=color:#e6db74>&#39;outfile&#39;</span>, nargs<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;?&#39;</span>, type<span style=color:#f92672>=</span>argparse<span style=color:#f92672>.</span>FileType(<span style=color:#e6db74>&#39;w&#39;</span>),
</span></span><span style=display:flex><span>                        default<span style=color:#f92672>=</span>sys<span style=color:#f92672>.</span>stdout)
</span></span><span style=display:flex><span>    main_parser<span style=color:#f92672>.</span>add_argument(<span style=color:#e6db74>&#34;-d&#34;</span>, <span style=color:#e6db74>&#34;--debug&#34;</span>,
</span></span><span style=display:flex><span>                        help<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;displays logging debug messages.&#34;</span>,
</span></span><span style=display:flex><span>                        action<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;store_true&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#75715e># ...</span>
</span></span></code></pre></div><dl><dt>Fix:</dt><dd>I would go about fixing this in two ways. Firstly, I would analyze the features offered by the CLI, determine the usefulness of each and cut the features that don&rsquo;t provide enough value to counteract the added complexity due to their inclusion in the code and the interface. By trimming the interface down like so we simplify the code but also improve the ease of use of the CLI.</dd></dl><p>Secondly, I would not use argparse unless I was forced to. The code, seen above, for setting your arguments up is not elegant when compared to the argument parsing module that I prefer to use: click. The code is cleaner, easier to setup and understand due to the design of the click module centering around function decorators. The difference between the modules is made clear when implementing sub-commands. Using the click module, sub-commands of a complex CLI each have their own function whereas with the argparse module all commands are defined and executed in a single main function.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#a6e22e>@click.group</span>()
</span></span><span style=display:flex><span><span style=color:#a6e22e>@click.argument</span>(<span style=color:#e6db74>&#39;IN_FILE&#39;</span>, type<span style=color:#f92672>=</span>click<span style=color:#f92672>.</span>Path(exists<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>))
</span></span><span style=display:flex><span><span style=color:#a6e22e>@click.option</span>(<span style=color:#e6db74>&#39;-v&#39;</span>, <span style=color:#e6db74>&#39;--verbose&#39;</span>, is_flag<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>, help<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Enable verbose logging.&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>@click.pass_context</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>cli</span>(ctx, in_file, verbose):
</span></span><span style=display:flex><span>    <span style=color:#75715e>#...</span>
</span></span></code></pre></div><p>The code above shows an alternate implementation using the click module. Also, the click module gives you more power by allowing you to implement custom parsing/validation for parameters which means that bad inputs can be caught before your main function starts executing.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ElementParamType</span>(click<span style=color:#f92672>.</span>ParamType):
</span></span><span style=display:flex><span>    name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;element&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>convert</span>(self, value, param, ctx):
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;&#34;&#34;Expands one letter element type code to full word&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> value <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;c&#39;</span>:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;characters&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>elif</span> value <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;w&#39;</span>:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;words&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>elif</span> value <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;s&#39;</span>:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;sentences&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>fail(
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;&#34;&#34;Choices must be &#39;c&#39; for characters, &#39;w&#39; for words
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    and &#39;s&#39; for sentences.&#34;&#34;&#34;</span>,
</span></span><span style=display:flex><span>                param, ctx)
</span></span><span style=display:flex><span>ELEMENT_TYPE <span style=color:#f92672>=</span> ElementParamType()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ...</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@click.option</span>( <span style=color:#e6db74>&#34;-t&#34;</span>, <span style=color:#e6db74>&#34;--type&#34;</span>, <span style=color:#e6db74>&#34;element_type&#34;</span>, type<span style=color:#f92672>=</span>ELEMENT_TYPE, default<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;w&#39;</span>,
</span></span><span style=display:flex><span>    help<span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;&#34;determine the type of text elements
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        (words, characters, sentences) to analyze&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span><span style=color:#75715e># ...</span>
</span></span></code></pre></div><dl><dt>Problem:</dt><dd>CLI parameters&rsquo; default values set in configuration files. Some command line parameters have default values which are taken from a configuration file as shown below.</dd></dl><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>show_parent_parser<span style=color:#f92672>.</span>add_argument(<span style=color:#e6db74>&#34;-s&#34;</span>, <span style=color:#e6db74>&#34;--show&#34;</span>, metavar<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;N&#34;</span>, type<span style=color:#f92672>=</span>int,
</span></span><span style=display:flex><span>                        <span style=color:#75715e># -&gt;</span>
</span></span><span style=display:flex><span>                        default<span style=color:#f92672>=</span>int(config[<span style=color:#e6db74>&#39;parser&#39;</span>][<span style=color:#e6db74>&#39;NumberToShow&#39;</span>]),
</span></span><span style=display:flex><span>                        <span style=color:#75715e># &lt;-</span>
</span></span><span style=display:flex><span>                        help<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;&#34;choose the number of results to
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                        show (if applicable)&#34;&#34;&#34;</span>)
</span></span></code></pre></div><p>I don&rsquo;t find this to be elegant because the configuration files (yes there more than one) contain very few values each. They add complexity to the system without adding enough (or any?) value to make up for it.</p><p>Also, these configurations files are hardcoded making it impossible to swap them on the fly without changing the code.</p><dl><dt>Fix:</dt><dd>Remove these configuration files and the code associated to them. Use sane default values for the associated command line parameters, if the user wants to change these they can on a per-call basis (or they can create a wrapper, <em>Facade design pattern</em>, around our CLI with their own allowing them to change the interface and handle the default values as they wish).</dd><dt>Problem:</dt><dd>Useless <em>stdout</em> redirection parameter. The <em>outfile</em> command line parameter shown below adds complexity to the interface while adding no value.</dd></dl><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>main_parser<span style=color:#f92672>.</span>add_argument(<span style=color:#e6db74>&#39;outfile&#39;</span>, nargs<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;?&#39;</span>, type<span style=color:#f92672>=</span>argparse<span style=color:#f92672>.</span>FileType(<span style=color:#e6db74>&#39;w&#39;</span>),
</span></span><span style=display:flex><span>    default<span style=color:#f92672>=</span>sys<span style=color:#f92672>.</span>stdout)
</span></span></code></pre></div><dl><dt>Fix:</dt><dd>We can remove the <em>outfile</em> command line argument and always print our results to <em>stdout</em>. Doing so allows the user redirect these results to their terminal (by default) or save the results into a file of their choice, etc. using the redirection/piping afforded to the user in any modern command line.</dd><dt>Problem:</dt><dd>Lack of comments. Excluding the shebang comment at the start, the outdated license comments at the start of each file and the commented out code there are two legitimate comments in the file presented below.</dd></dl><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_syllable_pattern</span>(name):
</span></span><span style=display:flex><span>    <span style=color:#75715e>#Shakespeare Sonnet</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> name <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;s&#39;</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> get_repeat_syllable_pattern(<span style=color:#ae81ff>10</span>, <span style=color:#ae81ff>14</span>)
</span></span><span style=display:flex><span>    <span style=color:#75715e>#Haiku</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>elif</span> name <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;h&#39;</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> [<span style=color:#ae81ff>7</span>,<span style=color:#ae81ff>5</span>,<span style=color:#ae81ff>7</span>]
</span></span></code></pre></div><p>Two comments is better than nothing but it&rsquo;s far from enough. I know what the inputs and the outputs (sort of) are for the writerator commands but the passage of time as well as the lack of comments makes it such that I can&rsquo;t easily say what&rsquo;s happening in the middle.</p><p>Are we using Markov Chains to pick words next to each other in a way that sort of makes sense? Are just looking at the number of syllables in the given input words and going from there?</p><p>My cursory look of the code hasn&rsquo;t given me that information.</p><dl><dt>Fix:</dt><dd>A couple comments explaining the why (not necessarily the how) would go a long way to demystifying this code.</dd><dt>Problem:</dt><dd>Tiny functions used once. There are around ten different tiny (1-5 lines) functions which are used exactly once in the code. I must have been thinking that taking a couple lines of code and putting them in a function with a descriptive name would make the code clearer.</dd></dl><p>I don&rsquo;t think this is usually the case and I don&rsquo;t think it is the case for the tiny functions in this file.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_readability_test_output</span>(text, test):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> test <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;g&#39;</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> get_Gunning_output(text)
</span></span></code></pre></div><dl><dt>Fix:</dt><dd>Take each of these functions, paste their implementations where they are called in the code and add a comment explaining the operation that&rsquo;s being performed if needed.</dd><dt>Problem:</dt><dd>Functions within functions without good reason. There isn&rsquo;t an inherent problem with putting functions inside of other functions in Python code but there has to be a reason for it. Otherwise, they act as misdirection reducing the clarity of the code. See the worst offender in the code below.</dd></dl><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>generate_ranked_list_output</span>(rank_list, number_to_show):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_last_index_for_output</span>(ranked_elements, number_to_display):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> len(ranked_elements) <span style=color:#f92672>&lt;</span> number_to_display:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> len(ranked_elements)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> number_to_display
</span></span><span style=display:flex><span>    last_index <span style=color:#f92672>=</span> get_last_index_for_output(rank_list, number_to_show)
</span></span><span style=display:flex><span>    <span style=color:#75715e># ...</span>
</span></span></code></pre></div><dl><dt>Fix:</dt><dd>Same as the &ldquo;Tiny functions used only once&rdquo; problem, remove these unneeded functions within functions.</dd></dl><h2 id=_texttoolspy_><em>texttools.py</em>
<a href=#_texttoolspy_>¶</a></h2><p>This file has 214 lines of code, 60 comment lines and 94 blank lines. It contains utility classes and functions for manipulating text, counting syllables and generating poems.</p><dl><dt>Problem:</dt><dd>Fail-safe alternate algorithm used in case of missing dependency. If the PyHyphen module is not found on the system instead of exiting gracefully (like it probably should) the code runs an alternate, and much worse, algorithm for counting the syllables in a word. A fail-safe like this could be an essential feature to have but in this case I don&rsquo;t think we need it given that the PyHyphen module should work and be accessible on any machine which can run python and can run our code.</dd><dt>Fix:</dt><dd>Remove the fail-safe code to simplify the code and ensure a more consistent quality to the poems we generate no matter the environment we run it in.</dd><dt>Problem:</dt><dd>Functions returning Boolean values using if statements badly. Functions written like this are a classic beginner&rsquo;s mistake. Code written like betrays a misunderstanding of how Boolean conditions work.</dd></dl><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>isAdverb</span>(self):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;Determines whether word is an adverb.&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> re<span style=color:#f92672>.</span><span style=color:#66d9ef>match</span>(<span style=color:#e6db74>r</span><span style=color:#e6db74>&#34;\w+ly&#34;</span>, self<span style=color:#f92672>.</span>text):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>True</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>False</span>
</span></span></code></pre></div><dl><dt>Fix:</dt><dd>There is a much simpler way of writing functions like this as shown below.</dd></dl><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>isAdverb</span>(self):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;Determines whether word is an adverb.&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> re<span style=color:#f92672>.</span><span style=color:#66d9ef>match</span>(<span style=color:#e6db74>r</span><span style=color:#e6db74>&#34;\w+ly&#34;</span>, self<span style=color:#f92672>.</span>text):
</span></span></code></pre></div><p>The understanding here is that an <em>if</em> condition evaluates to a Boolean value so returning <em>True</em> when it evaluates to true (and vice-versa) is pointless. I&rsquo;ve heard some people claim that the code above somehow improves the readability of the code compared to what I&rsquo;m proposing below; I disagree.</p><dl><dt>Problem:</dt><dd>Infinite loop. The following function contains a loop that can loop forever; the edge case where the code never manages to find a set of words which combine to give us the required number of syllables. Infinite loops are bad. We can either change the algorithm for this function which generates a line of poetry with a specific number of syllables or we can more easily add a sanity check which breaks out of the loop when we detect that we might be stuck.</dd></dl><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>generate_poem_line</span>(set_of_words, syllables_needed):
</span></span><span style=display:flex><span>    random_words <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>while</span> <span style=color:#66d9ef>True</span>:
</span></span><span style=display:flex><span>        random_words<span style=color:#f92672>.</span>append(random<span style=color:#f92672>.</span>choice(set_of_words))
</span></span><span style=display:flex><span>        syllable_count <span style=color:#f92672>=</span> sum([word<span style=color:#f92672>.</span>countSyllables() <span style=color:#66d9ef>for</span> word <span style=color:#f92672>in</span> random_words])
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> syllable_count <span style=color:#f92672>==</span> syllables_needed:
</span></span><span style=display:flex><span>            new_line <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34; &#34;</span><span style=color:#f92672>.</span>join([str(word) <span style=color:#66d9ef>for</span> word <span style=color:#f92672>in</span> random_words])
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> new_line<span style=color:#f92672>.</span>lower()<span style=color:#f92672>.</span>capitalize()
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>elif</span> syllable_count <span style=color:#f92672>&gt;</span> syllables_needed:
</span></span><span style=display:flex><span>            random_words <span style=color:#f92672>=</span> []
</span></span></code></pre></div><dl><dt>Fix:</dt><dd>Let&rsquo;s try to fix this potential infinite loop code the easy way (with a sanity check).</dd></dl><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>MAX_ITERATIONS <span style=color:#f92672>=</span> <span style=color:#ae81ff>1000</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>generate_poem_line</span>(set_of_words, syllables_needed):
</span></span><span style=display:flex><span>    counter <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    random_words <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>while</span> <span style=color:#66d9ef>True</span>:
</span></span><span style=display:flex><span>        random_words<span style=color:#f92672>.</span>append(random<span style=color:#f92672>.</span>choice(set_of_words))
</span></span><span style=display:flex><span>        syllable_count <span style=color:#f92672>=</span> sum([word<span style=color:#f92672>.</span>countSyllables() <span style=color:#66d9ef>for</span> word <span style=color:#f92672>in</span> random_words])
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> syllable_count <span style=color:#f92672>==</span> syllables_needed <span style=color:#f92672>or</span> counter <span style=color:#f92672>&gt;</span> MAX_ITERATIONS:
</span></span><span style=display:flex><span>            new_line <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34; &#34;</span><span style=color:#f92672>.</span>join([str(word) <span style=color:#66d9ef>for</span> word <span style=color:#f92672>in</span> random_words])
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> new_line<span style=color:#f92672>.</span>lower()<span style=color:#f92672>.</span>capitalize()
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>elif</span> syllable_count <span style=color:#f92672>&gt;</span> syllables_needed:
</span></span><span style=display:flex><span>            random_words <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>        counter <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>
</span></span></code></pre></div><h2 id=_datastorepy_><em>datastore.py</em>
<a href=#_datastorepy_>¶</a></h2><p>This file has 53 lines of code, 24 comment lines and 26 blank lines. It contains the DataStore class which is a cache containing the processed data from given text files allowing for quicker poem generation on subsequent runs using the same input text files.</p><dl><dt>Problem:</dt><dd>Inconsistent code formatting. This file has a lot of blank lines kind of randomly strewn about. If code isn&rsquo;t formatted with unified conventions, reading it can be distracting.</dd><dt>Fix:</dt><dd>We can remove these blank lines manually or we can use a tool such as <a href=https://github.com/google/yapf>Google&rsquo;s yapf</a> for automatically reformatting our code giving it a unified look.</dd></dl><h2 id=conclusion>Conclusion
<a href=#conclusion>¶</a></h2><p>I&rsquo;ve taken the time to fix the project given the recommendations above, you can take a look at the <a href=https://github.com/KeikakuB/writerator/tree/legacy>legacy code</a> or the <a href=https://github.com/KeikakuB/writerator/tree/master>current code</a>. I also made some improvements to the poetry generation algorithm using Markov Chains to produce poems that make much more sense.</p><p>It&rsquo;s not perfect, code never is, but it&rsquo;s definitely closer to perfection than before. I need to rework the caching system to allow for it to be disabled, and allow to user to use <em>stdin</em> as the input to allow for piping instead of using <em>.txt</em> files.</p><p>I believe this exercise was a success. I feel confident using it in my new Twitter poetry bot project now. Code review is usually best done by someone other than the programmer who wrote the code however given any significant amount of time (7+ years in this case) inevitably you won&rsquo;t be the same programmer you were back then.</p><blockquote class=blog-call-to-action><a href=https://fraidyc.at>Follow me with fraidycat</a>, or an <a href=https://en.wikipedia.org/wiki/RSS>RSS reader</a>, to be notified whenever I write something.</blockquote></div></div></div><div class="row justify-content-center"><div class="col-xl-6 readable-footer"><nav class=footer><div class="d-flex justify-content-center"><div class=col-12><div class="d-flex justify-content-center footer-paginator-next"><div class="next-article-link col-12 mx-auto"><a href=https://strategineer.com/blog/2019-08-28/>◀️Warhammer 40k - a Blast from the Past</a></div></div><div class="d-flex justify-content-center footer-paginator-previous"><div class="previous-article-link col-12 mx-auto"><a href=https://strategineer.com/blog/2019-06-08/>▶️Building a website for 17$ or less</a></div></div><div class="d-flex justify-content-center footer-shortlist-title"><span class=h4>Recent blog posts</span></div><div class=footer-shortlist-parent><ul class=footer-shortlist-list><li class=footer-shortlist-item><a href=https://strategineer.com/blog/2024-04-02/>What's Up Gamers</a></li><li class=footer-shortlist-item><a href=https://strategineer.com/blog/2023-01-02/>GOTY List 2022</a></li><li class=footer-shortlist-item><a href=https://strategineer.com/blog/2022-09-17/>Avoiding a slow death</a></li><li class=footer-shortlist-item><a href=https://strategineer.com/blog/2022-09-16/>10 reasons why I'm in love with bouldering</a></li><li class=footer-shortlist-item><a href=https://strategineer.com/blog/2022-08-22/>Tabletop Roleplaying: Getting your players to care</a></li><li class=footer-shortlist-archive><a href=/blog>... with 58 more in the archive</a></li></ul></div></div></div></nav></div></div><div class="offcanvas show offcanvas-bottom" data-bs-scroll=true data-bs-backdrop=false tabindex=-1 id=offcanvasBottom aria-label="navigation bar"><div class=offcanvas-body><div class="menu-buttons row justify-content-center"><div class=col-auto><div class=btn-toolbar role=toolbar aria-label="Main Toolbar"><div class="btn-group btn-group-lg"><a href=/authors/><button type=button aria-label="Go to Strat's bookshelf sorted by author" class="btn btn-lg btn-light">
<img loading=lazy alt="person icon" src=/icons/file-person.svg width=32 height=32 label="Go to Strat's author's he's read">
</button>
</a><a href=/books/tags><button type=button aria-label="Go to Strat's bookshelf sorted by genre" class="btn btn-lg btn-light">
<img loading=lazy alt="tag icon" src=/icons/tag.svg width=32 height=32 label="Go to Strat's author's he's read">
</button>
</a><a href=/books/><button type=button aria-label="Go to Strat's bookshelf sorted date read" class="btn btn-lg btn-light">
<img loading=lazy alt="book icon" src=/icons/book.svg width=32 height=32 label="Go to Strat's books he's reading">
</button>
</a><a href=/><button type=button aria-label="Go to Strat's blog" class="btn btn-lg btn-outline-dark">
<img loading=lazy alt="blog icon" src=/icons/journal-text.svg width=32 height=32 label="Go to Strat's Blog"></button></a></div></div></div></div></div></div></div></div></div><script defer type=text/javascript src=/js/bundle.min.js></script></body></html>