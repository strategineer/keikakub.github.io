let gen_data={},gen_debug=!1,strip_page_numbers=!0;function generate_text(e){let t;if(t=gen_data[e]){let n;if(n=select_from(t))return gen_debug?"["+e+":"+expand_tokens(n).trim()+"]":expand_tokens(n).trim()}return""}function generate_list_from_expr(e,t){let s=[],n;for(n=0;n<t;n++)s.push(expand_tokens(e));return s.join("<hr>")}function generate_list(e,t){let s=[],n;for(n=0;n<t;n++)s.push(generate_text(e));return s.join("<hr>")}function select_from(e){return e.constructor==Array?select_from_array(e):select_from_table(e)}function select_from_array(e){return e[Math.floor(Math.random()*e.length)]}function select_from_table(e){let t;if(t=scale_table(e)){let s=Math.floor(Math.random()*t)+1,n;for(n in e){let t=key_range(n);if(s>=t[0]&&s<=t[1])return e[n]}}return""}function scale_table(e){let t=0,n;for(n in e){let s=key_range(n);s[1]>t&&(t=s[1])}return t}function key_range(e){let t;return(t=/(\d+)-00/.exec(e))?[parseInt(t[1]),100]:(t=/(\d+)-(\d+)/.exec(e))?[parseInt(t[1]),parseInt(t[2])]:e=="00"?[100,100]:[parseInt(e),parseInt(e)]}function expand_tokens(e){let t;for(;t=/{(\w+)}/.exec(e);){let n=t[1],s;(s=generate_text(n))?e=e.replace("{"+n+"}",s):e=e.replace("{"+n+"}",n)}return strip_page_numbers?e.replace(/\(p. \d+\)/i,""):e}function roll(e,t){const n=getDiceResult(e);return t&&(t.innerHTML=`${e}: ${n.value}`),n.value}function rollOnManyTables(e,t,n){tables=zip(t,n);for(var i,a,s=0,o=[];s<tables.length;){const t=tables[s];i="",a="",o.push(`${e[s]}: ${i}${rollOnTable(e[s],t[0],t[1],1)}${a}`),s+=1}return o.join(" / ")}function rollOnTable(e,t,n,s){const r={key:e,title:e,tables:{default:n}},c=s===1;typeof s=="string"&&(s=getDiceResult(s).value);const l=new TableRoller,d=new RandomTable(r);for(var a,o=[],i=0;i<s;){const s=l.getTableResult(d),e=t.split("|").map(e=>e.trim()).filter(e=>e),n=s[0].result.split("|").map(e=>e.trim()).filter(e=>e);a=e.map(function(t,s){return e.length==1?n[s]:`${t}: ${n[s]}`}),o.push(a.join(" / ")),i+=1}if(!c){const t=o.map(function(e,t){return`${t}: ${o[t]}`});return`${s} ${e}: / ${t.join(" / ")}`}return o.join(" / ")}